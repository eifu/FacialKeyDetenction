<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Lab 3</title>
		<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
			body {
				align-content: center;
				text-align:center;
			}
      .frame {
        fill: none;
        stroke: #aaa;
      }

			.axis path,
			.axis line {
  				fill: none;
 				stroke: none;
			}
		</style>
	</head>
	<body>
	
	<script type="text/javascript">
	var labels = ["left_eye_center", "left_eye_outer_corner", "left_eye_inner_corner", "right_eye_center", "right_eye_inner_corner"];

var width = 960,
    size = 130,
    padding = 20;


   	var xScale = d3.scale.linear()
    .range([padding/2, size - padding / 2]);


   	var yScale = d3.scale.linear()
    .range([size - padding /2, padding / 2]);


    var xAxis = d3.svg.axis().orient("top");
    var yAxis = d3.svg.axis().orient("left");

   	d3.csv("scatter5x5.csv", function(error, data){
      var domainByTrait = {},
          traits = d3.keys(data[0]),
          num = traits.length;

        console.log(num);

   		traits.forEach(function(t){
           	domainByTrait[t] = d3.extent(data, function(d){return d[t];})		
   		});

      console.log(domainByTrait);

      var svg = d3.select("body").append("svg")
          .attr("width", size * (num) + padding)
          .attr("height", size * (num) + padding)
        .append("g")
          .attr("transform", "translate(" + padding + "," + padding/2 + ")");
           

		var cell = svg.selectAll(".cell")
    					.data(cross(traits, traits))
  						.enter().append("g")
              .attr("class", "cell")
              .attr("transform", function(d){return "translate(" + (num - d.i - 1) * size + "," + d.j * size + ")"; })
              .each(plot)

              cell.filter(function(d){return d.i == d.j;}).append("text")
              .attr("x", padding)
              .attr("y", padding)
              .attr("dy", ".71em")
              .text(function(d) {return d.x;})

            function plot(p){
              var cell = d3.select(this);

              xScale.domain(domainByTrait[p.x]);
              yScale.domain(domainByTrait[p.y]);

              cell.append("rect")
              .attr("class", "frame")
    					.attr("x", padding/2)
    					.attr("y", padding/2)
    					.attr("width", size - padding)
    					.attr("height", size - padding)

              cell.selectAll("circle")
              .data(data)
              .enter().append("circle")
              .attr("cx", function(d) { return xScale(d[p.x]); })
              .attr("cy", function(d) { return yScale(d[p.y]); })
              .attr("r", 1);

            }

   	});

    function cross(a, b) {
      var c = [], n = a.length, m = b.length, i, j;
      for (i = -1; ++i < n;) {
        for (j = -1; ++j < m;) {
          c.push({x: a[i], i: i, y: b[j], j: j});
        }
      }
      return c;
    }

	</script>
	</body>
</html>